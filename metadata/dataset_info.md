The table `customersegment-p-1d26.customersegment_trf.customer_sales_order_tmp` is denormalized. A unique order is characterized by the following sql CASE statement: ```WHEN cso.sales_channel_rk = 1 THEN cso.receipt_rk ELSE cso.online_order_code```
The tables `customersegment-p-1d26.customersegment_trf.customer_sales_order_tmp`, `customersegment-p-1d26.customersegment_srv.channel_preference`, and `customersegment-p-1d26.customersegment_srv.lifecycle_hst` can join with each other on `customer_brand_id`. `user_id` column from table `onlinebehaviour-p-e4a2.onlinebehaviour_srv.session` should be used to join with other tables on the column `business_partner_id`. When using the column `valid_to_date` it should be replaced by `coalesce(valid_to_date,'9999-01-01')`.
